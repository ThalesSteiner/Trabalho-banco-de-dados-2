CREATE SCHEMA IF NOT EXISTS n;


CREATE TABLE n.Champion (
    championName VARCHAR(50) PRIMARY KEY 
);

CREATE TABLE n.Summoner (
    summonerId VARCHAR(100) PRIMARY KEY
);


CREATE TABLE n.Partida (
    GameID VARCHAR(50) PRIMARY KEY,
    GameMode VARCHAR(20) NOT NULL CHECK (GameMode IN ('ARAM','CLASSIC')),
    timePlayed INT NOT NULL,
    gameEndedInSurrender BOOLEAN
);


CREATE TABLE n.TimeStats (
    GameID VARCHAR(50),
    teamId INT NOT NULL CHECK (teamId IN (100, 200)),
    win BOOLEAN,
    teamEarlySurrendered BOOLEAN,
    baronKills INT DEFAULT 0,
    dragonKills INT DEFAULT 0,
    inhibitorsLost INT CHECK (inhibitorsLost BETWEEN 0 AND 9), 
    turretsLost INT DEFAULT 0,
    nexusLost INT CHECK (nexusLost IN (0, 1)),
    
    CONSTRAINT pk_timestats PRIMARY KEY (GameID, teamId),
    CONSTRAINT fk_timestats_partida FOREIGN KEY (GameID) REFERENCES n.Partida(GameID) ON DELETE CASCADE
);

CREATE TABLE n.Jogador (
    GameID VARCHAR(50),
    summonerId VARCHAR(255),
    championName VARCHAR(50),
    teamId INT,

    individualPosition VARCHAR(7) CHECK (individualPosition IN ('TOP','MIDDLE','BOTTOM','JUNGLE','UTILITY')),
    lane VARCHAR(6) CHECK (lane IN ('TOP','MIDDLE','BOTTOM','JUNGLE','NONE')),
    
    champLevel INT CHECK (champLevel BETWEEN 1 AND 18),
    champExperience INT,
    
    kills INT DEFAULT 0,
    deaths INT DEFAULT 0,
    assists INT DEFAULT 0,
    goldEarned INT DEFAULT 0,
    goldSpent INT DEFAULT 0,
    totalMinionsKilled INT DEFAULT 0,
    bountyLevel INT,
    
    totalDamageDealtToChampions INT, 
    physicalDamageDealtToChampions INT, 
    magicDamageDealtToChampions INT,
    trueDamageDealtToChampions INT,
    damageDealtToObjectives INT,
    largestCriticalStrike INT,

    totalDamageTaken INT,
    physicalDamageTaken INT,
    magicDamageTaken INT,
    trueDamageTaken INT,
    damageSelfMitigated INT,

    visionScore INT,
    wardsPlaced INT,
    wardsKilled INT,
    visionWardsBoughtInGame INT,
    totalHeal INT,
    totalHealsOnTeammates INT,
    totalDamageShieldedOnTeammates INT,

    timeCCingOthers INT,
    totalTimeCCDealt INT,
    longestTimeSpentLiving INT,
    totalTimeSpentDead INT,

    turretTakedowns INT,
    inhibitorKills INT,
    objectivesStolen INT,
    firstBloodKill BOOLEAN,
    firstBloodAssist BOOLEAN,
    largestKillingSpree INT,

    spell1Casts INT DEFAULT 0,
    spell2Casts INT DEFAULT 0,
    spell3Casts INT DEFAULT 0,
    spell4Casts INT DEFAULT 0,
    summoner1Id INT,
    summoner1Casts INT DEFAULT 0,
    summoner2Id INT,
    summoner2Casts INT DEFAULT 0,

    CONSTRAINT pk_jogador PRIMARY KEY (GameID, summonerId),
    CONSTRAINT fk_jogador_partida FOREIGN KEY (GameID) REFERENCES n.Partida(GameID) ON DELETE CASCADE,
    CONSTRAINT fk_jogador_summoner FOREIGN KEY (summonerId) REFERENCES n.Summoner(summonerId) ON DELETE CASCADE,
    CONSTRAINT fk_jogador_champion FOREIGN KEY (championName) REFERENCES n.Champion(championName) ON DELETE SET NULL,
    CONSTRAINT fk_jogador_team FOREIGN KEY (GameID, teamId) REFERENCES n.TimeStats(GameID, teamId)
);


CREATE TABLE n.JogadorItem (
    GameID VARCHAR(50),
    summonerId VARCHAR(255),
    slotIndex INT NOT NULL CHECK (slotIndex BETWEEN 0 AND 6),
    itemId INT NOT NULL,

    CONSTRAINT pk_jogador_item PRIMARY KEY (GameID, summonerId, slotIndex),
    CONSTRAINT fk_item_jogador FOREIGN KEY (GameID, summonerId) REFERENCES n.Jogador(GameID, summonerId) ON DELETE CASCADE
);